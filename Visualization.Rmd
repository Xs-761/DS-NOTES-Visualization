---
title: "Visualization"
output: github_document
---

# What makes a good graph?

  - Be clear on intent
  - The right graph creates an "aha" moment
  - Dont overcomplicate
  - Get rid of the non-essential
  - Make it clear where to look
  - Words make a graph accessible
  - Audience trumps all else
  
# Using ggplot
  - Basic Graph Components\
    - Data, Aesthetic Mappings, Geoms
  - Advanced Graph Components
    - Facets, Statistics, Scales
  - A graph is built by combining these components
  - Graphics can be further customized, depending on the goals
    - Axis labels, axis tick locations/labels, font sizes, graphs themes, color scales, combining panels
    
# Where does visualization lies within the data processing phases?
  Import --> Tidy --> (Transform->Visualize->Model) --> Convey

# load packages
```{r, message=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)
```

# load the weather data
```{r}
weather_df = c()
```

# ggplot
```{r}
ggplot(weather_df, aes(x=tmin, y=tmax)) +  # Define the dataset used; Define the axies
  geom_point()
# New Approach Same Plot
weather_df %>%
  ggplot(aes(x=tmin, y=tmax)) + geom_point()
```

# Save and Edit a plot object
```{r}
weather_plot = 
    weather_df %>%
    ggplot(aes(x=tmin, y=tmax))

weather_plot + geom_point()
```

## Advanced Scatterplot

```{r}
weather_df %>%
    ggplot(aes(x=tmin, y=tmax, color=name)) + 
    geom_point() +
    geom_smooth(se=FALSE)   # Add Smooth Curves around the groups of data to help visualize the trends in separate groups
```

# What about the 'aes' placement?
```{r}
weather_df %>%
    ggplot(aes(x=tmin, y=tmax)) + 
    geom_point(aes(color=name)) +
    geom_smooth()
```

# Let's facet some things!
```{r}
weather_df %>%
    ggplot(aes(x=tmin, y=tmax, color=name)) + 
    geom_point(alpha=.2) + # transparency of the point
    geom_smooth() +
    facet_grid(. ~ name)   # separate panels ACCORDING TO different names
                           # 如果用 facet_grid(name ~ .) 则会横向排布
```

Let's combine some elements and try a new plot.
```{r}
weather_df %>%
    ggplot(aes(x=date, y=tmax, color=name)) + 
    geom_point(aes(size=prcp), alpha=.5) +   # adjust the point sizes according to prcp values (can change transparency accordingly too)
    geom_smooth(se=FALSE) +
    facet_grid( . ~ name )
```

## Some small notes

How many geoms have to exist?

```{r}
# You can have whatever geoms you want(might not be useful but applicable)
weather_df %>%
    ggplot(aes(x=tmin, y=tmax, color=name)) +
    geom_smooth(se=FALSE)
```

```{r}
weather_df %>%
    ggplot(aes(x=tmin, y=tmax)) +
    geom_hex()    # different styles
```

## Univariate Plot
```{r}
# Histograms are really great.

weather_df %>%
    ggplot(aes(x=tmin, color=name)) + # 边框色
    geom_histogram()

weather_df %>%
    ggplot(aes(x=tmin, fill=name)) +  # 填充色
    geom_histogram()

weather_df %>%
    ggplot(aes(x=tmin, color=name)) +
    geom_histogram() +
    facet_grid( . ~ name )

weather_df %>%
    ggplot(aes(x=tmin, color=name)) +
    geom_histogram(position="dodge")

weather_df %>%
    ggplot(aes(x=tmin, color=name)) +
    geom_density(alpha=.3)  # "smoothed out a little bit"
```

What about boxplots?
```{r}
weather_df %>%
    ggplot(aes(y=tmin)) +
    geom_boxplot()

weather_df %>%
    ggplot(aes(x=name, y=tmin)) +  # 在x轴会显示所有name category的箱线图
    geom_boxplot()

```

Trendy Plots
```{r}
weather %>%
    ggplot(aes(x=name, y=tmin, fill=name)) +
    geom_violin(alpha=.5) # a little bit more easier to understand straightforwardly the skewness and distributions
    stat_summary(fun="median")
```

Ridge Plots --- the most popular plot of 2017
```{r}
weather_df %>%
    ggplot(aes(x=tmin,y=name)) +
    geom_density_ridges()
```

# Save and Embed

Let's save a scatterplot.
```{r}
weather_plot = 
    weather_df %>%
    ggplot(aes(x=tmin, y=tmax, color=name))+
    geom_point(alpha=.5)
ggsave("weather_plot.pdf", weather_plot , width=8, height=5)    #ggsave("存储路径"(默认存储在work directory),存储名称, 图像长度, 图像宽度)
ggsave("./results/weather_plot.pdf", weather_plot , width=8, height=5) #ggsave("存储路径",存储名称, 图像长度, 图像宽度)

```

What about embedding?
```{r, fig.width=6, fig.height=3}
weather_plot

```

```{r}
weather_df %>%
    ggplot(aes(x=tmin, t=tmax, color=name)) +
    geom_point(alpha=.5)
    labs(
        title = "Temperature Plot",
        x = "Minimum daily temperature",
        y = "Maximum daily temperature",
        caption = "Data from RNOAA package: temperatures in 2017"
    )
```

# Scales

Start with the same plot
```{r}
weather_df %>%
    ggplot(aes(x=tmin, t=tmax, color=name)) +
    geom_point(alpha=.5)
    labs(
        title = "Temperature Plot",
        x = "Minimum daily temperature",
        y = "Maximum daily temperature",
        caption = "Data from RNOAA package: temperatures in 2017"
    ) +
    scale_x_continuous(
      breaks = c(-15, 0, 15),   # x轴分割为 -15, 0, 15三点
      labels = c("-15 C", "0", "15") # 标注分别的notes
    ) +
    scale_y_contiunous(
      position = "right"  #可以把y轴放在右侧
    ) +
    scale_color_hue(name="location", h=c(100, 200))
```

```{r}
weather_df %>%
    ggplot(aes(x=tmin, t=tmax, color=name)) +
    geom_point(alpha=.5)
    labs(
        title = "Temperature Plot",
        x = "Minimum daily temperature",
        y = "Maximum daily temperature",
        caption = "Data from RNOAA package: temperatures in 2017"
    ) +
    viridis::scale_color_viridis(
        name = "Location",
        discrete = TRUE
    )
```

# Themes

```{r}
weather_df %>%
    ggplot(aes(x=tmin, t=tmax, color=name)) +
    geom_point(alpha=.5)
    labs(
        title = "Temperature Plot",
        x = "Minimum daily temperature",
        y = "Maximum daily temperature",
        caption = "Data from RNOAA package: temperatures in 2017"
    ) +
    theme(legend.position="bottom")  # shift the legends to the bottom
```

change the global theme
```{r}
# by default the background is gray but you can change it
weather_df %>%
    ggplot(aes(x=tmin, t=tmax, color=name)) +
    geom_point(alpha=.5)
    labs(
        title = "Temperature Plot",
        x = "Minimum daily temperature",
        y = "Maximum daily temperature",
        caption = "Data from RNOAA package: temperatures in 2017"
    ) +
    theme_light()   # you can use ggtheme package to display more themes
                    # 这个theme挺好看的可以stick to it
```

## Setting Options
```{r}
library(tidyverse)
theme_set(theme_light() + theme(legend.position = "bottom"))

knitr:: opts_chunk$set(
  fig.width=6,
  fig.asp=.6,
  out.width = "90%"
)

options(
    ggplot2.continuous.colour="viridis",
    ggplot2.continous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

# Data Args in 'geom'
```{r}
central_park = 
    weather_df %>%
    filter(name=="CentralPark_NY")

waikiki = 
    weather_df %>%
    filter(name=="Waikiki_HA")

ggplot(data=waikiki, aes(x=date, y=tmax, color=name)) +
    geom_point() +
    geom_line(data=central_park)
```

# patchwork
```{r}
weather_df %>%
    ggplot(aes(x=tmin, fill=name)) + 
    geom_density(alpha=.5) + 
    facet_grid(.~name)

# what happens when you want multipanel plots ut can't facet?

weather_df %>%
    ggplot(aes(x=tmin, y=tmax, color=name)) +
    geom_pint(alpha=.5) +
    theme(legend.position = "none")

prcp_dens_p =
    weather_df %>%
    filter(prcp>0) %>%
    ggplot(aes(x=prcp, fill=name)) +
    geom_density(alpha=.5)

tmax_date_p =
    weather_df %>%
    ggplot(aes(x=date, y=tmax, color=name)) + 
    geom_point() +
    geom_smooth(SE=FALSE) +
    theme(legend.position="none")

tmax_date_p + prcp_dens_p + tmax_date_p # combine and arrange panels using patchwork
tmax_date_p + (prcp_dens_p + tmax_date_p) # 后两个占用一个panel空间
tmax_date_p / prcp_dens_p + tmax_date_p # 上下分隔

```

# Data Manipulation
```{r}

# change the order?

## CONTROL YOUR FACTORS

weather_df %>%
    mutate(
      name=factor(name), # changed name column to factor type
      name = forcats::fct_relevel(name, c("Waikiki_HA"))
    )
    ggplot(aes(x=name, y=tmax, color=name)) +
    geom_violin(alpha=.5)
    
# What if I wanted densities for tmin and tmax simultaneously?
weather_df %>%
    filter(name=="CentralPark_NY") %>%
    pivor_longer(
        tmax::tmin,
        names_to = "observation",
        values_to = "temperatures"
    ) %>%
    ggplot(aes(x=temperatures, fill=observation)) +
    geom_density(alpha=.5) +
    facet_grid(.~name)
    
```


# Revisit the pups
```{r}
pup_data = 
    read_csv("") %>%
    janitor::clean_names() %>%
    mutate(sex=recode(sex, `1`="male", `2`="female"))

litters_data =
    read_csv("") %>%
    janitor::clean_names() %>%
    separate(group, into=c("dose", "day_of_tx"),sep=3)

fas_data=left_join(pup_data, litters_data, by="litter_number")



```


